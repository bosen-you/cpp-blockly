<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.2.1/blockly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blockly/9.2.1/blocks_compressed.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <title>C++ Blockly</title>
    <style>
        /* 防止整頁滾動 */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; /* 確保填滿整個頁面 */
            overflow: hidden; /* 禁止頁面滾動 */
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #343a40;
            color: #fff;
            padding: 10px 20px;
            height: 50px;
            box-sizing: border-box; /* 包括padding在內的高度 */
        }

        header h1 {
            font-size: 1.3rem;
            margin: 0;
        }

        header .file-info {
            font-size: 1.5rem;
        }

        header .actions button {
            margin-left: 5px;
            padding: 10px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        header .actions button.compile { background-color: #0cc0df; color: #fff; }
        header .actions button.run { background-color: #ff914d; color: #fff; }
        header .actions button.run_compile { background-color: #69af23; color: #fff; }
        header .actions button.debug { background-color: #ff3131; color: #fff; }
        header .actions button.toggle-view { background-color: #005ad1; color: #fff; }
        header .actions button.help { background-color: #a458b9; color: #fff; }

        main {
            display: flex;
            height: calc(100vh - 50px); /* 剩餘高度分配給主區域 */
            overflow: hidden; /* 防止主區域滾動 */
        }

        .blockly-workspace, .code-view {
            padding: 20px;
            overflow-y: auto; /* 僅允許內部滾動 */
            transition: flex 0.5s;
        }

        .blockly-workspace {
            background-color: #e9ecef;
            height: auto;
            width: auto;
        }

        .code-view {
            background-color: #f8f9fa;
            border-left: 2px solid #ccc;
        }

        .code-view pre {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            background-color: #282c34;
            color: #fff;
            padding: 20px;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            line-height: 1.5;
            overflow: auto; /* 僅程式碼區允許滾動 */
            max-height: calc(100% - 20px); /* 限制滾動區域 */
        }

        .input-output {
            display: flex;
            flex-direction: column;
            background-color: #617ba8;
            color: #fff;
            padding: 10px;
        }

        .input-output .section {
            margin-bottom: 10px;
        }

        .input-output textarea {
            width: 96%;
            height: 100px;
            background-color: #282c34;
            color: #fff;
            resize: none;
            padding: 10px;
            border-radius: 4px;
            border: none;
        }

        .input-output button {
            margin-top: 10px;
            padding: 10px;
            border: none;
            background-color: #2f335a;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
        }

        /* 默認樣式：各占一半 */
        .blockly-workspace, .code-view { flex: 1; }
        .blockly-only .blockly-workspace { flex: 1; }
        .blockly-only .code-view { flex: 0; display: none; }
        .code-only .blockly-workspace { flex: 0; display: none; }
        .code-only .code-view { flex: 1; }

        #blockly-workspace {
            height: auto;
            width: auto;
            background: #cccccc;
        }

        /* Smaller Blockly block sizes */
        .blocklySvg {
            transform: scale(1.0);
            transform-origin: top left;
        }

        /* Makes our label white. */
        .blocklyTreeLabel {
            color: black;
        }

        /* Adds padding around the group of categories and separators. */
        .blocklyToolboxContents {
            padding: 0.01em;
        }

        /* Adds space between the categories, rounds the corners and adds space around the label. */
        .blocklyTreeRow {
            padding: 3px;
            margin-bottom: 0.5em;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <header>
        <h1>C++ Blockly</h1>
        <div class="file-info">檔案名稱： <strong>main.cpp</strong></div>
        <div class="actions">
            <button class="compile">編譯</button>
            <button class="run">執行</button>
            <button class="run_compile">編譯&執行</button>
            <button class="debug">除錯</button>
            <button class="toggle-view" id="toggle-button" onclick="toggleView()">切換模式</button>
            <button class="help" onclick="window.location.href='https://hackmd.io/@cpp-blockly'">尋求幫助?</button>
        </div>
    </header>
    <main id="main-container">
        <div class="blockly-workspace" id="blockly-workspace"></div>
        <div class="code-view">
            <div class="input-output">
                <div class="section">
                    <h3>轉換程式碼 <button  onclick="copyText('code-output')">複製</button> <button onclick="downloadText('code-output', 'main.cpp')">下載</button></h3>
                </div>
                <div id="code-output"></div>
                <div class="section">
                    <h3>輸入測資 <button>複製測資</button> <button>送出測資</button> <button>重置測資</button></h3>
                    <textarea placeholder="請在這裡輸入測資..."></textarea>
                </div>
                <div class="section">
                    <h3>編譯/執行結果 <button>複製結果</button> <button>下載結果</button></h3>
                    <textarea readonly placeholder="結果將顯示在這裡..."></textarea>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentModeIndex = 0;
        const modes = [
            { className: '', next: '各占一半' },
            { className: 'code-only', next: '程式碼/測試' },
            { className: 'blockly-only', next: '全Blockly' },
        ];

        function toggleView() {
            const mainContainer = document.getElementById('main-container');
            const toggleButton = document.getElementById('toggle-button');
            currentModeIndex = (currentModeIndex + 1) % modes.length;
            mainContainer.className = modes[currentModeIndex].className;
            toggleButton.textContent = modes[currentModeIndex].next;
            Blockly.svgResize(workspace);

            // 先執行縮放到適合大小
            workspace.zoomToFit();

            // 延遲進一步調整縮放比例
            setTimeout(() => {
                workspace.setScale(0.75); // 設置縮放比例為 0.75
                const metrics = workspace.getMetrics();

                // 重新置中
                const xOffset = (metrics.viewWidth - metrics.contentWidth * 0.5) / 2.2;
                const yOffset = (metrics.viewHeight - metrics.contentHeight * 0.5) / 3;
                workspace.scroll(xOffset, yOffset);
            }, 100); // 延遲 100 毫秒以確保 `zoomToFit` 生效
        }

        document.getElementById('toggle-button').textContent = "切換模式";

    </script>

    <script>
        class CustomCategory extends Blockly.ToolboxCategory {
            /* Constructor for a custom category.
            /** @override */
            setSelected(isSelected) {
                // We do not store the label span on the category, so use getElementsByClassName.
                var labelDom = this.rowDiv_.getElementsByClassName('blocklyTreeLabel')[0];
                if (isSelected) {
                    // Change the background color of the div to white.
                    this.rowDiv_.style.backgroundColor = "#b8b8b8";
                    // Set the colour of the text to white.
                    labelDom.style.color = 'white';
                } else {
                    // Set the background back to the original colour.
                    this.rowDiv_.style.backgroundColor = this.colour_;
                    // Set the text back to black.
                    labelDom.style.color = 'black';
                }
                // This is used for accessibility purposes.
                Blockly.utils.aria.setState( /** @type {!Element} */ (this.htmlDiv_),
                    Blockly.utils.aria.State.SELECTED, isSelected);
            }

            addColourBorder_(colour) {
                this.rowDiv_.style.backgroundColor = colour;
            }
            constructor(categoryDef, toolbox, opt_parent) {
                super(categoryDef, toolbox, opt_parent);
            }
        }

        Blockly.registry.register(
            Blockly.registry.Type.TOOLBOX_ITEM,
            Blockly.ToolboxCategory.registrationName,
            CustomCategory, true);

        Blockly.ContextMenuRegistry.registry.register({
            id: 'help_custom',
            weight: 100,
            displayText: function() {
                return "help?";
            },
            preconditionFn: function(scope) {
                return 'enabled'; // 確保選項顯示
            },
            callback: function(scope) {
                window.open("https://hackmd.io/@cpp-blockly", "_blank");
            },
            scopeType: Blockly.ContextMenuRegistry.ScopeType.BLOCK,
            alt: false,
            shift: false
        });

        const toolbox =
            `
                <xml>
                    <category name="其他延伸模組" colour="black">
                        <category name="序列容器 Vector" colour="#6A5ACD">
                            <block type="define_vector"></block>
                            <block type="push_back"></block>
                            <block type="emplace_back"></block>
                            <block type="pop_back"></block>
                            <block type="vector_insert"></block>
                            <block type="vector_erase"></block>
                            <block type="vector_clear"></block>
                            <block type="vector_size"></block>
                            <block type="vector_empty"></block>

                            <label text="Vector 迭代器"></label>

                            <block type="vec_begin"></block>
                            <block type="vec_end"></block>
                            <block type="vec_rbegin"></block>
                            <block type="vec_rend"></block>
                            
                        </category>

                        <category name="關聯式容器 Set" colour="#ff5d04">
                            <block type="create_set"></block>
                            <block type="set_insert"></block>
                            <block type="set_erase"></block>
                            <block type="set_empty"></block>
                            <block type="set_find"></block>

                            <label text="set 迭代器"></label>

                            <block type="set_begin"></block>
                            <block type="set_end"></block>
                        </category>

                        <category name="陣列 Map" colour="#20b2aa">
                            <block type="create_map"></block>
                            <block type="map_insert"></block>
                            <block type="map[i]"></block>
                            <block type="map_clear"></block>
                            <block type="map_size"></block>
                            <block type="map_empty"></block>
                            <block type="map_first"></block>
                            <block type="map_second"></block>
                            <block type="map_find"></block>

                            <label text="map 迭代器"></label>

                            <block type="map_begin"></block>
                            <block type="map_end"></block>
                            <block type="map_rbegin"></block>
                            <block type="map_rend"></block>
                        </category>

                        <category name="陣列 Array" colour="#fa8072">
                            <block type="create_array"></block>
                            <block type="array_name_block"></block>
                            <block type="array_content"></block>
                            <block type="array[i]"></block>
                        </category>

                        <category name="演算法 algorithm" colour="#3cb371">
                            <block type="sort"></block>
                            <block type="max"></block>
                            <block type="min"></block>
                            <block type="find"></block>
                        </category>

                        <category name="數學 Math" colour="#00A9E6">
                            <block type="math_sqrt"></block>
                            <block type="math_abs"></block>
                            <block type="math_sine"></block>
                            <block type="math_cosine"></block>
                            <block type="math_tangent"></block>
                            <block type="math_ceil"></block>
                            <block type="math_floor"></block>
                            <block type="math_random"></block>
                        </category> 

                        <category name="時間 Ctime" colour="#eac800">
                            <block type="get_current_timestamp"></block>
                            <block type="calculate_time_difference"></block>
                            <block type="convert_to_local_time"></block>
                            <block type="convert_to_utc_time"></block>
                            <block type="format_time_string"></block>
                            <block type="set_time_structure"></block>
                            <block type="read_time_structure_member"></block>
                            <block type="get_current_local_time"></block>
                            <block type="get_current_utc_time"></block>
                        </category> 
                    </category>

                    <sep></sep>

                    <category name="主程式框架" colour="#FF69B4">
                        <label text="警告! int main()一個檔案只能有一個!!!"></label>

                        <block type="include_bits/stdc++.h">
                            <next>
                                <block type="using_namespace_std">
                                    <next>
                                        <block type="main_block"></block>
                                    </next>
                                </block>
                            </next>
                        </block>
                    </category>

                    <category name="自定義函式" colour="#BA55D3">
                        <block type="function_definition_void"></block>
                        <block type="function_definition"></block>
                        <block type="function_call"></block>
                    </category>

                    <category name="自定義變數" colour="#DABD00">
                        <block type="declare_variable"></block>
                        <block type="variable_assignment"></block>
                        <block type="get_variable"></block>
                    </category>

                    <sep></sep>

                    <category name="輸入與輸出" colour="#24B324">
                        <block type="cin_block"></block>
                        <block type="cout_block"></block>
                        <block type="scanf_block"></block>
                        <block type="printf_block"></block>
                        <block type="boost_ios_sync"></block>
                        <block type="boost_cin_cout_tie"></block>
                    </category>

                    <category name="數學與運算" colour="#29A1CD">
                        <block type="logic_operators"></block>
                        <block type="or_and_xor"></block>
                        <block type="var_caculacte"></block>
                        <block type="math_caculacte"></block>
                        <block type="number"></block>
                        <block type="false"></block>
                        <block type="true"></block>
                        <block type="nullptr"></block>
                        <block type="logic_not"></block>
                    </category>

                    <category name="條件與迴圈" colour="#00abea">
                        <block type="controls_if"></block>
                        <block type="switch_block">
                            <statement name="DO">
                                <block type="case_block">
                                    <next>
                                        <block type="default_block"></block>
                                    </next>
                                </block>
                            </statement>
                        </block>
                        <block type="case_block"></block>
                        <block type="for_block"></block>
                        <block type="while_block"></block>
                        <block type="break_block"></block>
                        <block type="continue_block"></block>
                        <block type="return_block"></block>
                    </category>

                    <category name="擴充模組" colour="#71b700">
                        <block type="commas"></block>
                        <block type="math_multiply"></block>
                        <block type="math_devide"></block>
                        <block type="math_plus"></block>
                        <block type="math_subtract"></block>
                        <block type="math_percent"></block>
                    </category>

                    <category name="文本操作" colour="#FF8C00">
                        <block type="text"></block>
                        <block type="add_line"></block>
                        <block type="tab"></block>
                        <block type="comment_block"></block>
                    </category>

                    <sep></sep>

                    <category name="測試 Block" colour="#E60000">
                        
                    </category>
                </xml>
            `;

        var workspace = Blockly.inject('blockly-workspace', {
            toolbox: toolbox,
            scrollbars: true,
            trashcan: true,
            grid: {
                spacing: 20,
                length: 3,
                colour: "#ccc",
                snap: true
            },
            zoom: {
                controls: true,
                wheel: true,
                startScale: 0.7,
                maxScale: 2.0,
                minScale: 0.5,
                scaleSpeed: 1.5
            },
            renderer: 'zelos'/*minimalist*/
        });

        let toolboxXml = Blockly.Xml.textToDom(toolbox);

        function updateVariableCategory() {
            let variableCategory = toolboxXml.querySelector('category[name="自定義變數"]');
            if (!variableCategory) {
                console.error("未找到 '自定義變數' 類別");
                return null;
            }
            return variableCategory;
        }

        function syncVariableBlocks() {
            // 找到所有宣告的變數名稱
            const declaredVariables = new Set(
                workspace.getAllBlocks()
                .filter(block => block.type === 'variable_declaration')
                .map(block => block.getFieldValue('variable'))
            );

            // 找到現有的變數文字方塊名稱
            const variableCategory = updateVariableCategory();
            if (!variableCategory) return;

            const existingVariableBlocks = Array.from(variableCategory.children).map(block => block.getAttribute('type').replace('variable_get_', ''));

            // 補齊缺失的文字方塊
            declaredVariables.forEach(variableName => {
                if (!existingVariableBlocks.includes(variableName)) {
                    // 定義新文字方塊
                    Blockly.defineBlocksWithJsonArray([{
                        "type": `variable_get_${variableName}`,
                        "message0": "%1",
                        "args0": [{
                            "type": "field_label",
                            "name": "VAR_NAME",
                            "text": variableName
                        }],
                        "output": null,
                        "colour": "#DABD00",
                        "tooltip": `獲取變數 ${variableName} 的值`,
                        "helpUrl": ""
                    }]);

                    // 將文字方塊加入工具箱
                    const newBlock = document.createElement('block');
                    newBlock.setAttribute('type', `variable_get_${variableName}`);
                    variableCategory.appendChild(newBlock);
                    Blockly.Cpp[`variable_get_${variableName}`] = function() {
                        return [variableName, Blockly.Cpp.ORDER_ATOMIC];
                    };
                }
            });

            // 移除不存在的變數文字方塊
            existingVariableBlocks.forEach(variableName => {
                if (!declaredVariables.has(variableName)) {
                    // 移除工具箱中的無效方塊
                    const blockToRemove = variableCategory.querySelector(`block[type="variable_get_${variableName}"]`);
                    if (blockToRemove) blockToRemove.remove();

                    // 刪除 Blockly 定義
                    delete Blockly.Blocks[`variable_get_${variableName}`];
                    delete Blockly.Cpp[`variable_get_${variableName}`];
                }
            });

            // 更新工具箱
            workspace.updateToolbox(toolboxXml);
        }

        function removeUndefinedVariableBlocks() {
            const declaredVariables = new Set(
                workspace.getAllBlocks()
                .filter(block => block.type === 'variable_declaration')
                .map(block => block.getFieldValue('variable'))
            );

            workspace.getAllBlocks().forEach(block => {
                // 檢查是否是未定義的變數文字方塊
                if (block.type.startsWith('variable_get_')) {
                    const variableName = block.type.replace('variable_get_', '');
                    if (!declaredVariables.has(variableName)) {
                        // 如果變數文字方塊未被宣告則刪除該方塊
                        block.dispose();
                    }
                }
            });
        }

        workspace.addChangeListener((event) => {
            if (event.type === Blockly.Events.BLOCK_CREATE || event.type === Blockly.Events.BLOCK_DELETE || event.type === Blockly.Events.BLOCK_CHANGE) {
                syncVariableBlocks();
                removeUndefinedVariableBlocks();
            }
        });

        Blockly.Cpp = new Blockly.Generator('Cpp');
        Blockly.Cpp.ORDER_ATOMIC = 1;

        workspace.addChangeListener(() => {
            updateCodeOutput();
        });

        const originalBlockToCode = Blockly.Cpp.blockToCode;

        Blockly.Cpp.blockToCode = function(block) {
            if (!block) {
                return '';
            }

            let code = originalBlockToCode.call(this, block);

            const nextBlock = block.getNextBlock();
            if (nextBlock) {
                code += Blockly.Cpp.blockToCode(nextBlock);
            }

            return code;
        };

        function updateCodeOutput() {
            var code = Blockly.Cpp.workspaceToCode(workspace); // 獲取 Blockly 生成的 C++ 代碼
            var lines = code.split('\n'); // 按行分割代碼
            var outputElement = document.getElementById('code-output');

            outputElement.innerHTML = ''; // 清空現有內容
            var codeBlock = document.createElement('pre'); // 使用 <pre> 包裝代碼塊
            var codeContent = document.createElement('code'); // 使用 <code> 放置代碼內容
            codeContent.className = 'language-cpp'; // 設置語言類型為 C++（適用於 highlight.js）

            // 設置字體大小、高度和邊框樣式
            codeBlock.style.height = '150px'; // 設置高度
            codeBlock.style.width = 'auto';
            codeBlock.style.overflowX = 'auto'; // 開啟垂直滾動條
            codeBlock.style.overflowY = 'auto'; // 開啟垂直滾動條
            codeContent.style.fontSize = '16px'; // 設置字體大小

            // 將每行代碼添加到 codeContent
            codeContent.textContent = code; // 保持代碼的原始格式
            codeBlock.appendChild(codeContent);
            outputElement.appendChild(codeBlock); // 添加代碼塊到輸出區域

            // 初始化 highlight.js，處理語法高亮
            hljs.highlightElement(codeContent);

            // 渲染 Markdown 區域
            function renderMarkdown() {
                const markdownInput = document.getElementById('markdown-input');
                const markdownOutput = document.getElementById('output');

                // 確保 Markdown 輸入區域存在
                if (markdownInput && markdownOutput) {
                    const markdownText = markdownInput.value; // 獲取 Markdown 文本
                    const htmlContent = marked.parse(markdownText); // 轉換 Markdown 為 HTML
                    markdownOutput.innerHTML = htmlContent;

                    // 處理嵌套的代碼高亮
                    markdownOutput.querySelectorAll('pre code').forEach((el) => {
                        hljs.highlightElement(el);
                    });
                }
            }

            // 配置 marked.js，啟用 highlight.js 支援
            marked.setOptions({
                highlight: function(code, lang) {
                    const validLang = hljs.getLanguage(lang) ? lang : 'plaintext';
                    return hljs.highlight(code, {
                        language: validLang
                    }).value;
                }
            });

            // 初次渲染 Markdown 區域
            renderMarkdown();
        }


        function copyText(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => alert("Copied!"));
        }

        function downloadText(elementId, filename) {
            const text = document.getElementById(elementId).textContent;
            const blob = new Blob([text], {
                type: "text/plain"
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        delete Blockly.Blocks['controls_if'];
        delete Blockly.Blocks['text'];

        //Add the Cpp blocks def.
        Blockly.defineBlocksWithJsonArray(
            [
                //initializaiton
                { //#include <bits/stdc++.h>
                    "type": "include_bits/stdc++.h",
                    "message0": "#include <bits/stdc++.h>",
                    "nextStatement": null,
                    "colour": "#C00000",
                    "tooltip": "Include all",
                    "helpUrl": ""
                },
                { //int main
                    "type": "main_block",
                    "message0": "int main()",
                    "message1": "%1",
                    "args1": [{
                        "type": "input_statement",
                        "name": "DO"
                    }],
                    "message2": "return 0",
                    "colour": "#24B324",
                    "previousStatement": null,
                    "inputsInline": false,
                    "tooltip": "Main function for executing code",
                    "helpUrl": ""
                },        
                { //using namespace std
                    "type": "using_namespace_std",
                    "message0": "using namespace std;",
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#3d7fd6",
                    "tooltip": "Use the standard namespace",
                    "helpUrl": ""
                },
                { //ios sync
                    "type": "boost_ios_sync",
                    "message0": "ios::sync_with_stdio(0);",
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": 160,
                    "tooltip": "禁用同步以提高輸入輸出效率",
                    "helpUrl": ""
                },
                { //cin tie
                    "type": "boost_cin_cout_tie",
                    "message0": "cin & cout tie",
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": 160,
                    "tooltip": "解除 cin 和 cout 的綁定",
                    "helpUrl": ""
                },

                //data
                { //text
                    "type": "text",
                    "message0": "text %1",
                    "args0": [{
                        "type": "field_input",
                        "name": "TEXT",
                        "text": "Hello world"
                    }],
                    "output": "String",
                    "colour": "#FF8C00",
                    "tooltip": "A text value",
                    "helpUrl": ""
                },
                { //"\n"
                    "type": "add_line",
                    "message0": "換行",
                    "output": "String",
                    "colour": "#FF8C00",
                    "tooltip": "A text value",
                    "helpUrl": ""
                },
                { //tab
                    "type": "tab",
                    "message0": "tab",
                    "output": "String",
                    "colour": "#FF8C00",
                    "tooltip": "A text value",
                    "helpUrl": ""
                },
                { //number
                    "type": "number",
                    "message0": "number %1",
                    "args0": [{
                        "type": "field_number",
                        "name": "NUMBER",
                        "value": 0
                    }],
                    "output": "Number",
                    "colour": "#29A1CD",
                    "tooltip": "數字",
                    "helpUrl": ""
                },
                { //comment
                    "type": "comment_block",
                    "message0": "// %1",
                    "args0": [{
                        "type": "field_input",
                        "name": "COMMENT",
                        "text": "註解"
                    }],
                    "colour": "#FF8C00",
                    "previousStatement": null,
                    "nextStatement": null,
                    "tooltip": "添加註解",
                    "helpUrl": ""
                },

                //condition
                { //if
                    "type": "controls_if",
                    "message0": "if %1",
                    "args0": [{
                        "type": "input_value",
                        "name": "IF0",
                        "check": "Boolean"
                    }],
                    "message1": "do %1",
                    "args1": [{
                        "type": "input_statement",
                        "name": "DO0"
                    }],
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#00abea",
                    "tooltip": "如果條件為真，執行",
                    "helpUrl": "",
                    "mutator": "controls_if_mutator"
                },
                { //for
                    "type": "for_block",
                    "message0": "for %1 = %2 ; %3 ; %4 = %5 %6 ",
                    "args0": [{
                            "type": "field_input",
                            "name": "VAR",
                            "text": "i"
                        },
                        {
                            "type": "input_value",
                            "name": "INIT"
                        },
                        {
                            "type": "input_value",
                            "name": "CONDITION",
                            "check": "Boolean"
                        },
                        {
                            "type": "field_input",
                            "name": "VAR2",
                            "text": "i"
                        },
                        {
                            "type": "input_value",
                            "name": "CONDITION2"
                        },
                        {
                            "type": "input_statement",
                            "name": "DO"
                        }
                    ],
                    "previousStatement": null,
                    "nextStatement": null,
                    "inputsInline": true,
                    "colour": "#00abea",
                    "tooltip": "重複執行直到條件為假",
                    "helpUrl": ""
                },
                { //while
                    "type": "while_block",
                    "message0": "while (%1) {",
                    "args0": [{
                        "type": "input_value",
                        "name": "CONDITION",
                        "check": "Boolean"
                    }],
                    "message1": "%1 }",
                    "args1": [{
                        "type": "input_statement",
                        "name": "DO"
                    }],
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#00abea"
                },
                { //switch
                    "type": "switch_block",
                    "message0": "switch %1 %2",
                    "args0": [{
                            "type": "input_value",
                            "name": "SWITCH_VALUE"
                        },
                        {
                            "type": "input_statement",
                            "name": "DO"
                        }
                    ],
                    "colour": "#00abea",
                    "previousStatement": null,
                    "nextStatement": null,
                    "tooltip": "Switch 語句",
                    "helpUrl": ""
                },
                { //case
                    "type": "case_block",
                    "message0": "case %1 %2 break",
                    "args0": [{
                            "type": "input_value",
                            "name": "CASE_VALUE"
                        },
                        {
                            "type": "input_statement",
                            "name": "DO"
                        }
                    ],
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#00abea",
                    "tooltip": "Case 語句",
                    "helpUrl": ""
                },
                { //default
                    "type": "default_block",
                    "message0": "default %1 break",
                    "args0": [{
                        "type": "input_statement",
                        "name": "DO"
                    }],
                    "previousStatement": null,
                    "colour": "#00abea",
                    "tooltip": "Default 語句",
                    "helpUrl": ""
                },
                
                //stop
                { //break
                    "type": "break_block",
                    "message0": "break",
                    "colour": "#00abea",
                    "previousStatement": null,
                    "tooltip": "退出當前的循環或 switch 語句",
                    "helpUrl": ""
                },
                { //continue
                    "type": "continue_block",
                    "message0": "continue",
                    "colour": "#00abea",
                    "previousStatement": null,
                    "tooltip": "跳過當前迴圈的剩餘部分，直接進入下一次迴圈",
                    "helpUrl": ""
                },
                { //return
                    "type": "return_block",
                    "message0": "return %1",
                    "args0": [{
                        "type": "input_value",
                        "name": "RETURN_VALUE"
                    }],
                    "colour": "#00abea",
                    "previousStatement": null,
                    "tooltip": "從函式返回值",
                    "helpUrl": ""
                },
                
                //function
                { //def function void
                    "type": "function_definition_void",
                    "message0": "函式 型態void 名子%1 (變數%2){",
                    "args0": [
                        {
                            "type" : "field_input",
                            "name" : "funcName",
                        },
                        {
                            "type" : "input_value",
                            "name" : "data",
                        }
                    ],
                    "message1" : "%1 回傳值%2",
                    "args1" : [
                        {
                            "type" : "input_statement",
                            "name" : "DO"
                        },
                        {
                            "type" : "field_dropdown",
                            "name" : "expression",
                            "options" : [
                                ["return", "return"],
                                ["no", "no"]
                            ]
                        }
                    ],
                    "colour": "#E60000",
                    "tooltip": "定義一個基本的 C++ 函數",
                    "helpUrl": ""
                },
                { //def function void
                    "type": "function_definition",
                    "message0": "函式 型態%1 名子%2 (變數%3){",
                    "args0": [{
                            "type": "field_dropdown",
                            "name": "TYPE",
                            "options": [
                                ["void", "void"],
                                ["int", "int"],
                                ["float", "float"],
                                ["double", "double"],
                                ["char", "char"],
                                ["string", "std::string"]
                            ]
                        },
                        {
                            "type" : "field_input",
                            "name" : "funcName",
                        },
                        {
                            "type" : "input_value",
                            "name" : "data",
                        }
                    ],
                    "message1" : "%1 回傳值%2(如果型態是void只能加return)}",
                    "args1" : [
                        {
                            "type" : "input_statement",
                            "name" : "DO"
                        },
                        {
                            "type" : "input_value",
                            "name" : "expression"
                        }
                    ],
                    "colour": "#E60000",
                    "tooltip": "定義一個基本的 C++ 函數",
                    "helpUrl": ""
                },
                { //cll function
                    "type": "function_call",
                    "message0": "函式%1 %2",
                    "args0": [{
                            "type": "field_input",
                            "name": "funcName",
                        },
                        {
                            "type": "input_value",
                            "name": "VALUE"
                        }
                    ],
                    "colour": "#E60000",
                    "previousStatement": null,
                    "nextStatement": null,
                    "tooltip": "調用一個函數",
                    "helpUrl": ""
                },        
                
                //define variable
                { //def variable
                    "type": "declare_variable",
                    "message0" : "declare %1 %2 %3 變數名稱: %4 = %5",
                    "args0" : [
                        {
                            "type": "field_dropdown",
                            "name": "const",
                            "options": [
                                ["const", "const"],
                                ["no", "no"]
                            ]
                        },
                        {
                            "type": "field_dropdown",
                            "name": "unsigned",
                            "options": [
                                ["unsigned", "unsigned"],
                                ["no", "no"]
                            ]
                        },
                        {
                            "type": "field_dropdown",
                            "name": "TYPE",
                            "options": [
                                ["int", "int"],
                                ["float", "float"],
                                ["double", "double"],
                                ["char", "char"],
                                ["string", "std::string"],
                                ["long long", "long long"]
                            ]
                        },
                        {
                            "type" : "field_input",
                            "name" : "var_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "value"
                        },
                    ],
                    "colour": "#DABD00",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "",
                    "helpurl" : ""
                },
                { //variable equals
                    "type": "variable_assignment",
                    "message0": "variable %1 = %2",
                    "args0": [{
                            "type": "field_input",
                            "name": "VAR_NAME",
                            "text": "i"
                        },
                        {
                            "type": "input_value",
                            "name": "VALUE"
                        }
                    ],
                    "colour": "#DABD00",
                    "previousStatement": null,
                    "nextStatement": null,
                    "tooltip": "賦予變數新的值或算式",
                    "helpUrl": ""
                },
                { //get variable vaule
                    "type": "get_variable",
                    "message0": "%1",
                    "args0": [{
                        "type": "field_input",
                        "name": "VAR_NAME",
                        "text": "i"
                    }],
                    "output": null,
                    "colour": "#DABD00",
                    "tooltip": "獲取變數的值",
                    "helpUrl": ""
                },                
                
                //operation
                { //& | ^ Not
                    "type": "or_and_xor",
                    "message0": "%1 %2 %3",
                    "args0": [{
                            "type": "input_value",
                            "name": "A"
                        },
                        {
                            "type": "field_dropdown",
                            "name": "OPERATOR",
                            "options": [
                                ["&&", "AND"],
                                ["||", "OR"],
                                ["^", "XOR"],
                                ["!", "NOT"]
                            ]
                        },
                        {
                            "type": "input_value",
                            "name": "B"
                        }
                    ],
                    "output": "Boolean",
                    "colour": "#29A1CD",
                    "inputsInline": true,
                    "tooltip": "or and xor",
                    "helpUrl": ""
                },
                { //logic operators
                    "type": "logic_operators",
                    "message0": "%1 %2 %3",
                    "args0": [{
                            "type": "input_value",
                            "name": "A"
                        },
                        {
                            "type": "field_dropdown",
                            "name": "OPERATOR",
                            "options": [
                                ["==", "EQUAL"],
                                ["!=", "NOT_EQUAL"],
                                [">", "GREATER"],
                                ["<", "LESS"],
                                [">=", "GREATER_EQUAL"],
                                ["<=", "LESS_EQUAL"]
                            ]
                        },
                        {
                            "type": "input_value",
                            "name": "B"
                        }
                    ],
                    "output": "Boolean",
                    "colour": "#29A1CD",
                    "inputsInline": true,
                    "tooltip": "Performs selected logical or comparison operation.",
                    "helpUrl": ""
                },
                { //logic not
                    "type": "logic_not",
                    "message0": "!%1",
                    "args0": [{
                        "type": "input_value",
                        "name": "A"
                    }],
                    "output": "Boolean",
                    "colour": "#29A1CD",
                    "tooltip": "Returns true if the condition is false.",
                    "helpUrl": ""
                },
                
                //input and output
                { //printf
                    "type": "printf_block",
                    "message0": "printf(%1, %2)",
                    "args0": [{
                            "type": "input_value",
                            "name": "FORMAT"
                        },
                        {
                            "type": "input_value",
                            "name": "VARIABLE"
                        }
                    ],
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#24B324",
                    "tooltip": "使用 printf 輸出格式化的字串",
                    "helpUrl": ""
                },
                { //cin
                    "type": "cin_block",
                    "message0": "cin >> %1",
                    "args0": [{
                        "type": "input_value",
                        "name": "VARIABLES"
                    }],
                    "inputsInline": true,
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#24B324",
                    "tooltip": "Inputs multiple values from the console.",
                    "helpUrl": ""
                },
                { //cout
                    "type": "cout_block",
                    "message0": "cout << %1 %2",
                    "args0": [{
                            "type": "input_value",
                            "name": "INPUT"
                        },
                        {
                            "type": "field_dropdown",
                            "name": "ENDL_OPTION",
                            "options": [
                                ["<< endl", "endl"],
                                ["no endl", ""]
                            ]
                        }
                    ],
                    "inputsInline": true,
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#24B324",
                    "tooltip": "Outputs value to the console.",
                    "helpUrl": ""
                },
                                
                //bool
                { //true
                    "type": "true",
                    "message0": "true",
                    "output": "Boolean",
                    "colour": "#29A1CD",
                    "tooltip": "",
                    "helpUrl": ""
                },
                { //false
                    "type": "false",
                    "message0": "false",
                    "output": "boolean",
                    "colour": "#29A1CD",
                    "tooltip": "",
                    "helpUrl": ""
                },
                
                //pointer
                { //null
                    "type": "nullptr",
                    "message0": "nullptr",
                    "output": "Pointer",
                    "colour": "#29A1CD",
                    "tooltip": "",
                    "helpUrl": ""
                },
                { //var caculacte
                    "type": "var_caculacte",
                    "message0": "%1  %2  %3",
                    "args0": [{
                            "type": "input_value",
                            "name": "A"
                        },
                        {
                            "type": "field_dropdown",
                            "name": "OPERATOR",
                            "options": [
                                ["+=", "ADD_EQUALS"],
                                ["-=", "SUBTRACT_EQUALS"],
                                ["*=", "MUTIPLY_EQUALS"],
                                ["/=", "DEVIDE_EQUALS"],
                                ["%=", "MODULO_EQUALS"]
                            ]
                        },
                        {
                            "type": "input_value",
                            "name": "B"
                        }
                    ],
                    "output": "Number",
                    "colour": "#29A1CD",
                    "inputsInline": true,
                    "tooltip": "運算",
                    "helpUrl": ""
                },

                //Standard Library
                //math
                { //math caculacte
                    "type": "math_caculacte",
                    "message0": "%1  %2  %3",
                    "args0": [{
                            "type": "input_value",
                            "name": "A"
                        },
                        {
                            "type": "field_dropdown",
                            "name": "OPERATOR",
                            "options": [
                                ["+", "ADD"],
                                ["-", "SUBTRACT"],
                                ["*", "MUTIPLY"],
                                ["/", "DEVIDE"],
                                ["//", "DEVIDE_INT"],
                                ["%", "MODULO"],
                                ["^", "POWER"]
                            ]
                        },
                        {
                            "type": "input_value",
                            "name": "B"
                        }
                    ],
                    "output": "Number",
                    "colour": "#29A1CD",
                    "inputsInline": true,
                    "tooltip": "運算",
                    "helpUrl": ""
                },
                { //sqrt
                    "type": "math_sqrt",
                    "message0": "sqrt(%1)",
                    "args0": [{
                        "type": "input_value",
                        "name": "X"
                    }],
                    "output": "Number",
                    "colour": "#00A9E6",
                    "tooltip": "平方根運算",
                    "helpUrl": ""
                },
                { //abs
                    "type": "math_abs",
                    "message0": "abs(%1)",
                    "args0": [{
                        "type": "input_value",
                        "name": "A"
                    }],
                    "output": "Number",
                    "colour": "#00A9E6",
                    "tooltip": "絕對值運算",
                    "helpUrl": ""
                },
                { //sin
                    "type": "math_sine",
                    "message0": "sin(%1)",
                    "args0": [{
                        "type": "input_value",
                        "name": "ANGLE"
                    }],
                    "output": "Number",
                    "colour": "#00A9E6",
                    "tooltip": "正弦運算",
                    "helpUrl": ""
                },
                { //cos
                    "type": "math_cosine",
                    "message0": "cos(%1)",
                    "args0": [{
                        "type": "input_value",
                        "name": "ANGLE"
                    }],
                    "output": "Number",
                    "colour": "#00A9E6",
                    "tooltip": "餘弦運算",
                    "helpUrl": ""
                },
                { //tan
                    "type": "math_tangent",
                    "message0": "tan(%1)",
                    "args0": [{
                        "type": "input_value",
                        "name": "ANGLE"
                    }],
                    "output": "Number",
                    "colour": "#00A9E6",
                    "tooltip": "正切運算",
                    "helpUrl": ""
                },
                { //ceil
                    "type": "math_ceil",
                    "message0": "ceil(%1)",
                    "args0": [{
                        "type": "input_value",
                        "name": "X"
                    }],
                    "output": "Number",
                    "colour": "#00A9E6",
                    "tooltip": "向上取整",
                    "helpUrl": ""
                },
                { //floor
                    "type": "math_floor",
                    "message0": "floor(%1)",
                    "args0": [{
                        "type": "input_value",
                        "name": "X"
                    }],
                    "output": "Number",
                    "colour": "#00A9E6",
                    "tooltip": "向下取整",
                    "helpUrl": ""
                },
                { //random
                    "type": "math_random",
                    "message0": "rand() % %1",
                    "args0": [{
                        "type": "input_value",
                        "name": "RANGE"
                    }],
                    "output": "Number",
                    "colour": "#00A9E6",
                    "tooltip": "隨機數生成",
                    "helpUrl": ""
                },
                
                //vector
                { //define vector
                    "type": "define_vector",
                    "message0": "資料型態%1 , 名字 : %2 , 大小 : %3(可加可不加) : 陣列內容 : %4(可加可不加)",
                    "args0": [{
                            "type": "field_dropdown",
                            "name": "TYPE",
                            "options": [
                                ["int", "int"],
                                ["float", "float"],
                                ["double", "double"],
                                ["char", "char"],
                                ["string", "std::string"],
                                ["long long", "long long"]
                            ]
                        },
                        {
                            "type": "field_input",
                            "name": "vec_name",
                        },
                        {
                            "type": "input_value",
                            "name": "vec_size"
                        },
                        {
                            "type": "input_value",
                            "name": "vec_content"
                        }
                    ],
                    "colour": "#6A5ACD",
                    "previousStatement": null,
                    "nextStatement": null,
                    "tooltip": "create a vector, vector is a dynamic array",
                    "helpurl": ""
                },
                { //vector push back
                    "type": "push_back",
                    "message0": "在 %1 新增 %2 在最後一個(只能輸入單個)",
                    "args0": [{
                            "type": "field_input",
                            "name": "vec_name"
                        },
                        {
                            "type": "input_value",
                            "name": "number"
                        }
                    ],
                    "inputsInline": true,
                    "output": null,
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#6A5ACD",
                    "tooltip": "push back number to vector",
                    "helpUrl": ""
                },
                { //vector pop back
                    "type": "pop_back",
                    "message0": "在 %1 刪除最後一個",
                    "args0": [{
                        "type": "field_input",
                        "name": "vec_name"
                    }, ],
                    "inputsInline": true,
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#6A5ACD",
                    "tooltip": "push back number to vector",
                    "helpUrl": ""
                },
                { //vector clear
                    "type": "vector_clear",
                    "message0": "把 %1 的元素全部清除",
                    "args0": [{
                        "type": "field_input",
                        "name": "vec_name"
                    }, ],
                    "inputsInline": true,
                    "previousStatement": null,
                    "nextStatement": null,
                    "colour": "#6A5ACD",
                    "tooltip": "vector size",
                    "helpUrl": ""
                },
                { //vector size
                    "type": "vector_size",
                    "message0": "%1 的陣列大小",
                    "args0": [{
                        "type": "field_input",
                        "name": "vec_name"
                    }],
                    "inputsInline": true,
                    "output": null,
                    "colour": "#6A5ACD",
                    "tooltip": "vector size",
                    "helpUrl": ""
                },
                { //vec empty
                    "type" : "vector_empty",
                    "message0" : "判斷vec%1是否為空",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "vec_name"
                        }
                    ],
                    "colour": "#6A5ACD",
                    "output" : null,
                    "helpUrl": ""
                },
                { //vector insert
                    "type" : "vector_insert",
                    "message0" : "vector%1 在%2位置插入%3",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "vec_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "pos"
                        },
                        {
                            "type" : "input_value",
                            "name" : "value"
                        }
                    ],
                    "colour": "#6A5ACD",
                    "inputsInline": true,
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "create a vector, vector is a dynamic array",
                    "helpurl" : ""
                },
                { //vector erase
                    "type" : "vector_erase",
                    "message0" : "vector%1 在%2位置刪除%3",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "vec_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "pos"
                        },
                        {
                            "type" : "input_value",
                            "name" : "value"
                        }
                    ],
                    "colour": "#6A5ACD",
                    "inputsInline": true,
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "create a vector, vector is a dynamic array",
                    "helpurl" : ""
                },
                { //emplace back
                    "type": "emplace_back",
                    "message0": "在 %1 新增 %2 在最後一個(可輸入多個 , 用空白分開)",
                    "args0": [
                    {
                        "type": "field_input",
                        "name": "NAME",
                        "check" : ["Number" , "String"]
                    },
                    {
                        "type": "field_input",
                        "name": "number",
                        "text": ""
                    }
                    ],
                    "inputsInline": true,
                    "output": null,
                    "nextStatement": null,
                    "colour": "#6A5ACD",
                    "tooltip": "push back number to vector",
                    "helpUrl": ""
                },
                { //vec begin
                    "type": "vec_begin",
                    "message0": "陣列%1的第一個(begin)",
                    "args0": [{
                            "type": "field_input",
                            "name": "vec_name",
                            "check": "String"
                        }

                    ],
                    "colour": "#778899",
                    "output": null,
                    "helpUrl": ""
                },
                { //vec end
                    "type": "vec_end",
                    "message0": "陣列%1的最後一個(end)",
                    "args0": [{
                            "type": "field_input",
                            "name": "vec_name",
                            "check": "String"
                        }

                    ],
                    "colour": "#778899",
                    "output": null,
                    "helpUrl": ""
                },
                { //vec rbegin
                    "type": "vec_rbegin",
                    "message0": "陣列%1的最後一個(rbegin)",
                    "args0": [{
                            "type": "field_input",
                            "name": "vec_name",
                            "check": "String"
                        }

                    ],
                    "colour": "#778899",
                    "output": null,
                    "helpUrl": ""
                },
                { //vec rend
                    "type": "vec_rend",
                    "message0": "陣列%1的第一個(rend)",
                    "args0": [{
                            "type": "field_input",
                            "name": "vec_name",
                            "check": "String"
                        }

                    ],
                    "colour": "#778899",
                    "output": null,
                    "helpUrl": ""
                },
                                
                //map
                { //create map
                    "type" : "create_map",
                    "message0" : "資料型態 <%1, %2>, 陣列名稱 %3, 大小%4, 陣列內容%5",
                    "args0" : [
                        {
                            "type": "field_dropdown",
                            "name": "TYPE1",
                            "options": [
                                ["int", "int"],
                                ["float", "float"],
                                ["double", "double"],
                                ["char", "char"],
                                ["string", "std::string"],
                                ["long long", "long long"]
                            ]
                        },
                        {
                            "type": "field_dropdown",
                            "name": "TYPE2",
                            "options": [
                                ["int", "int"],
                                ["float", "float"],
                                ["double", "double"],
                                ["char", "char"],
                                ["string", "std::string"],
                                ["long long", "long long"]
                            ]
                        },
                        {
                            "type" : "field_input",
                            "name" : "map_name",
                            "check" : "String"
                        },
                        {
                            "type" : "input_value", 
                            "name" : "map_size",
                            "check" : "Number"
                        },
                        {
                            "type" : "input_value",
                            "name" : "content"
                        }
                    ],
                    "inputsInline": true,
                    "colour": "#20b2aa",
                    "output" : null,
                    "helpUrl": ""
                },
                { //map insert
                    "type" : "map_insert",
                    "message0" : "map%1新增陣列元素{%2, %3}",
                    "args0" :[
                        {
                            "type" : "field_input",
                            "name" : "map_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "first"
                        },
                        {
                            "type" : "input_value",
                            "name" : "second"
                        },
                    ],
                    "colour": "#20b2aa",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "path 1 to insert key and value in map"
                },
                { //map[i]
                    "type" : "map[i]",
                    "message0" : "map名稱%1, key: %2, value: %3",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "map_name"
                        },
                        {
                            "type" : "field_input",
                            "name" : "map_key"
                        },
                        {
                            "type" : "field_input",
                            "name" : "map_value"
                        }
                    ],
                    "colour": "#20b2aa",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "path 2 to insert key and value in map"
                },
                { //map begin
                    "type": "map_begin",
                    "message0": "陣列%1的第一個(begin)",
                    "args0": [{
                            "type": "field_input",
                            "name": "map_name",
                            "check": "String"
                        }

                    ],
                    "colour": "#778899",
                    "output": null,
                    "helpUrl": ""
                },
                { //map end
                    "type": "map_end",
                    "message0": "陣列%1的最後一個(end)",
                    "args0": [{
                            "type": "field_input",
                            "name": "map_name",
                            "check": "String"
                        }

                    ],
                    "colour": "#778899",
                    "output": null,
                    "helpUrl": ""
                },
                { //map rbegin
                    "type": "map_rbegin",
                    "message0": "陣列%1的最後一個(rbegin)",
                    "args0": [{
                            "type": "field_input",
                            "name": "map_name",
                            "check": "String"
                        }

                    ],
                    "colour": "#778899",
                    "output": null,
                    "helpUrl": ""
                },
                { //map rend
                    "type": "map_rend",
                    "message0": "陣列%1的第一個(rend)",
                    "args0": [{
                            "type": "field_input",
                            "name": "map_name",
                            "check": "String"
                        }

                    ],
                    "colour": "#778899",
                    "output": null,
                    "helpUrl": ""
                },
                { //map clear
                    "type": "map_clear",
                    "message0": "把 %1 的元素全部清除",
                    "args0": [{
                        "type": "field_input",
                        "name": "map_name"
                    }, ],
                    "colour": "#20b2aa",
                    "inputsInline": true,
                    "previousStatement": null,
                    "nextStatement": null,
                    "tooltip": "map size",
                    "helpUrl": ""
                },
                { //map size
                    "type": "map_size",
                    "message0": "%1 的陣列大小",
                    "args0": [{
                        "type": "field_input",
                        "name": "map_name"
                    }],
                    "colour": "#20b2aa",
                    "inputsInline": true,
                    "output": null,
                    "tooltip": "map size",
                    "helpUrl": ""
                },
                { //map empty
                "type" : "map_empty",
                "message0" : "判斷map%1是否為空",
                "args0" : [
                    {
                        "type" : "field_input",
                        "name" : "map_name"
                    }
                ],
                "colour": "#20b2aa",
                "output" : null,
                "helpUrl": ""
                },
                { //map first
                    "type" : "map_first",
                    "message0" : "map: %1, 位置: %2的key(first)",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "map_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "key"
                        }
                    ],
                    "output" : null,
                    "colour": "#20b2aa",
                    "tooltip": "map key(first)",
                    "helpUrl": ""
                },
                { //map second
                    "type" : "map_second",
                    "message0" : "map: %1, 位置: %2的value(second)",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "map_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "key"
                        }
                    ],
                    "output" : null,
                    "colour": "#20b2aa",
                    "tooltip": "map value(second)",
                    "helpUrl": ""
                },
                { //map find
                    "type" : "map_find",
                    "message0" : "map: %1 中尋找有沒有%2(key)值",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "map_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "value"
                        }
                    ],
                    "output" : null,
                    "colour": "#20b2aa",
                    "tooltip": "find key in map\nif find the key return key",
                    "helpUrl": ""
                },

                //array
                { //create array
                    "type": "create_array",
                    "message0": "資料型態%1 , 陣列名稱%2 , 大小 : %3 , 陣列內容%4(可加可不佳)",
                    "args0": [{
                            "type": "field_dropdown",
                            "name": "TYPE",
                            "options": [
                                ["int", "int"],
                                ["float", "float"],
                                ["double", "double"],
                                ["char", "char"],
                                ["string", "std::string"],
                                ["long long", "long long"]
                            ]
                        },
                        {
                            "type": "field_input",
                            "name": "array_name",
                            "text": "array"
                        },
                        {
                            "type": "input_value",
                            "name": "size",
                            "check": "Number",
                            "output": "Number"
                        },
                        {
                            "type": "input_value",
                            "name": "content"
                        }
                    ],
                    "colour": "#fa8072",
                    "previousStatement": null,
                    "nextStatement": null,
                    "tooltip": "create a vector, vector is a dynamic array",
                    "helpurl": ""
                },
                { //array_name_block
                    "type": "array_name_block",
                    "message0": "陣列%1",
                    "args0": [{
                            "type": "field_input",
                            "name": "array_name",
                            "text": "array"
                        }

                    ],
                    "colour": "#fa8072",
                    "output": null,
                    "tooltip": "array name",
                    "helpurl": ""
                },
                { //array_content
                    "type": "array_content",
                    "message0": "陣列內容{%1}",
                    "args0": [{
                        "type": "input_value",
                        "name": "content"
                    }],
                    "colour": "#fa8072",
                    "output": null,
                    "tooltip": "array name",
                    "helpurl": ""
                },
                { //array[i]
                    "type" : "array[i]",
                    "message0" : "陣列%1[%2]",
                    "args0" :[
                        {
                            "type" : "field_input",
                            "name" : "array_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "pos"
                        }
                    ],
                    "colour": "#fa8072",
                    "output": null,
                    "tooltip": "array name",
                    "helpurl": ""
                },

                //time
                { //get current timestamp
                    "type": "get_current_timestamp",
                    "message0": "Get Current Timestamp",
                    "output": "time_t",
                    "colour": "#eac800",
                    "tooltip": "Returns the current time as a timestamp.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },
                { //calculate time difference
                    "type": "calculate_time_difference",
                    "message0": "Time Difference between %1 and %2",
                    "args0": [
                        { "type": "input_value", "name": "END_TIME", "check": "time_t" },
                        { "type": "input_value", "name": "START_TIME", "check": "time_t" }
                    ],
                    "output": "Number",
                    "colour": "#eac800",
                    "tooltip": "Calculates the difference in seconds between two timestamps.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },
                { //convert to local time
                    "type": "convert_to_local_time",
                    "message0": "Convert %1 to Local Time",
                    "args0": [
                        { "type": "input_value", "name": "TIMESTAMP", "check": "time_t" }
                    ],
                    "output": "tm",
                    "colour": "#eac800",
                    "tooltip": "Converts a timestamp to local time as a structure.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },
                { //convert to utc time
                    "type": "convert_to_utc_time",
                    "message0": "Convert %1 to UTC Time",
                    "args0": [
                        { "type": "input_value", "name": "TIMESTAMP", "check": "time_t" }
                    ],
                    "output": "tm",
                    "colour": "#eac800",
                    "tooltip": "Converts a timestamp to UTC time as a structure.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },
                { //format time string
                    "type": "format_time_string",
                    "message0": "Format Time %1 with Format %2",
                    "args0": [
                        { "type": "input_value", "name": "TIME_STRUCT", "check": "tm" },
                        { "type": "field_input", "name": "FORMAT", "text": "%Y-%m-%d %H:%M:%S" }
                    ],
                    "output": "String",
                    "colour": "#eac800",
                    "tooltip": "Formats a time structure into a string using the given format.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },
                { //set time structure
                    "type": "set_time_structure",
                    "message0": "Set Time Structure: Year %1 Month %2 Day %3 Hour %4 Minute %5 Second %6",
                    "args0": [
                        { "type": "input_value", "name": "YEAR", "check": "Number" },
                        { "type": "input_value", "name": "MONTH", "check": "Number" },
                        { "type": "input_value", "name": "DAY", "check": "Number" },
                        { "type": "input_value", "name": "HOUR", "check": "Number" },
                        { "type": "input_value", "name": "MINUTE", "check": "Number" },
                        { "type": "input_value", "name": "SECOND", "check": "Number" }
                    ],
                    "output": "tm",
                    "colour": "#eac800",
                    "tooltip": "Creates a time structure with the given values.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },
                { //read time structure member
                    "type": "read_time_structure_member",
                    "message0": "Read %1 from Time Structure %2",
                    "args0": [
                        { "type": "field_dropdown", "name": "MEMBER", "options": [
                            ["Year", "tm_year"],
                            ["Month", "tm_mon"],
                            ["Day", "tm_mday"],
                            ["Hour", "tm_hour"],
                            ["Minute", "tm_min"],
                            ["Second", "tm_sec"]
                        ]},
                        { "type": "input_value", "name": "TIME_STRUCT", "check": "tm" }
                    ],
                    "output": "Number",
                    "colour": "#eac800",
                    "tooltip": "Reads a specific member from a time structure.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },
                { //get current local time
                    "type": "get_current_local_time",
                    "message0": "Get Current Local Time",
                    "output": "tm",
                    "colour": "#eac800",
                    "tooltip": "Returns the current local time as a tm structure.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },
                { //get current utc time
                    "type": "get_current_utc_time",
                    "message0": "Get Current UTC Time",
                    "output": "tm",
                    "colour": "#eac800",
                    "tooltip": "Returns the current UTC time as a tm structure.",
                    "helpUrl": "",
                    "previousStatement": null,
                    "nextStatement": null
                },

                //set
                { //create set
                    "type" : "create_set",
                    "message0": "創建set 資料型態%1 , 名字 : %2 , 大小 : %3(可加可不加) : 陣列內容 : %4(可加可不加)",
                    "args0" : [
                        {
                            "type": "field_dropdown",
                            "name": "TYPE",
                            "options": [
                                ["int", "int"],
                                ["float", "float"],
                                ["double", "double"],
                                ["char", "char"],
                                ["string", "std::string"],
                                ["long long", "long long"]
                            ]
                        },
                        {
                            "type" : "field_input",
                            "name" : "set_name",
                        },
                        {
                            "type" : "input_value",
                            "name" : "set_size"
                        },
                        {
                            "type" : "input_value",
                            "name" : "set_content"
                        }
                    ],
                    "colour" : "#ff5d04",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "create a set, set is a ordered list",
                    "helpurl" : ""
                },
                { //set insert
                    "type" : "set_insert",
                    "message0" : "set%1插入%2",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "set_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "value"
                        }
                    ],
                    "colour" : "#ff5d04",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "insert value to set",
                    "helpurl" : ""
                },
                { //set erase
                    "type" : "set_erase",
                    "message0" : "set%1刪除%2",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "set_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "value"
                        }
                    ],
                    "colour" : "#ff5d04",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "insert value to set",
                    "helpurl" : ""
                },
                { //set begin
                    "type" : "set_begin",
                    "message0" : "set%1的第一個(begin)",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "set_name",
                            "check" : "String"
                        }

                    ],
                    "colour" : "#778899",
                    "output" : null,
                    "helpUrl": ""
                },
                { //set end
                    "type" : "set_end",
                    "message0" : "set%1的最後一個(end)",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "set_name",
                            "check" : "String"
                        }

                    ],
                    "colour" : "#778899",
                    "output" : null,
                    "helpUrl": ""
                },
                { //set empty
                    "type" : "set_empty",
                    "message0" : "判斷set%1是否為空",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "set_name"
                        }
                    ],
                    "colour" : "#ff5d04",
                    "output" : null,
                    "helpUrl": ""
                },
                { //set find
                    "type" : "set_find",
                    "message0" : "set: %1 中尋找有沒有%2(key)值",
                    "args0" : [
                        {
                            "type" : "field_input",
                            "name" : "set_name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "value"
                        }
                    ],
                    "colour" : "#ff5d04",
                    "output" : null,
                    "tooltip": "find value in set\nif find the key return value",
                    "helpUrl": ""
                },

                //algorithm
                { //algorithm sort
                    "type" : "sort",
                    "message0" : "%1 陣列%2排序, 範圍(頭: %3, 尾: %4)",
                    "args0" : [ 
                        {
                            "type" : "field_dropdown",
                            "name" : "TYPE",
                            "options" : [
                                ["內建陣列", "內建陣列"],
                                ["模組陣列", "模組陣列"]
                            ]
                        },
                        {
                            "type" : "field_input",
                            "name" : "name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "start"
                        },
                        {
                            "type" : "input_value",
                            "name" : "end"
                        }
                    ],
                    "colour" : "#3cb371",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "sort array"
                },
                { //algorithm max
                    "type" : "max",
                    "message0" : "%1 陣列%2最大值, 範圍(頭: %3, 尾: %4)",
                    "args0" : [ 
                        {
                            "type" : "field_dropdown",
                            "name" : "TYPE",
                            "options" : [
                                ["內建陣列", "內建陣列"],
                                ["模組陣列", "模組陣列"]
                            ]
                        },
                        {
                            "type" : "field_input",
                            "name" : "name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "start"
                        },
                        {
                            "type" : "input_value",
                            "name" : "end"
                        }
                    ],
                    "colour" : "#3cb371",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "search maximum element in array"
                },
                { //algorithm min
                    "type" : "min",
                    "message0" : "%1 陣列%2最小值, 範圍(頭: %3, 尾: %4)",
                    "args0" : [ 
                        {
                            "type" : "field_dropdown",
                            "name" : "TYPE",
                            "options" : [
                                ["內建陣列", "內建陣列"],
                                ["模組陣列", "模組陣列"]
                            ]
                        },
                        {
                            "type" : "field_input",
                            "name" : "name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "start"
                        },
                        {
                            "type" : "input_value",
                            "name" : "end"
                        }
                    ],
                    "colour" : "#3cb371",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "search minimum element in array"
                },
                { //algorithm find
                    "type" : "find",
                    "message0" : "%1 陣列%2尋找%3 範圍(頭: %4, 尾: %5)",
                    "args0" : [ 
                        {
                            "type" : "field_dropdown",
                            "name" : "TYPE",
                            "options" : [
                                ["內建陣列", "內建陣列"],
                                ["模組陣列", "模組陣列"]
                            ]
                        },
                        {
                            "type" : "field_input",
                            "name" : "name"
                        },
                        {
                            "type" : "input_value",
                            "name" : "value"
                        },
                        {
                            "type" : "input_value",
                            "name" : "start"
                        },
                        {
                            "type" : "input_value",
                            "name" : "end"
                        }
                    ],
                    "colour" : "#3cb371",
                    "previousStatement" : null,
                    "nextStatement" : null,
                    "tooltip" : "sort array"
                }
            ]
        );
        
        Blockly.Blocks['math_generic'] = {
            init: function() {
                this.setColour("#71b700");
                this.setOutput(true, "Number");
                this.setInputsInline(true);
                this.setMutator(new Blockly.Mutator(['math_generic_item']));
                this.itemCount_ = 2;
                this.operator_ = '+'; // 默認運算符為加法
                this.updateShape_();
            },
            mutationToDom: function() {
                const container = document.createElement('mutation');
                container.setAttribute('items', this.itemCount_);
                container.setAttribute('operator', this.operator_);
                return container;
            },
            domToMutation: function(xmlElement) {
                this.itemCount_ = parseInt(xmlElement.getAttribute('items'), 10);
                this.operator_ = xmlElement.getAttribute('operator') || '+';
                this.updateShape_();
            },
            decompose: function(workspace) {
                const containerBlock = workspace.newBlock('math_generic_container');
                containerBlock.initSvg();
                let connection = containerBlock.getInput('STACK').connection;
                for (let i = 0; i < this.itemCount_; i++) {
                    const itemBlock = workspace.newBlock('math_generic_item');
                    itemBlock.initSvg();
                    connection.connect(itemBlock.previousConnection);
                    connection = itemBlock.nextConnection;
                }
                return containerBlock;
            },
            compose: function(containerBlock) {
                let itemBlock = containerBlock.getInputTargetBlock('STACK');
                const connections = [];
                while (itemBlock) {
                    connections.push(itemBlock.valueConnection_);
                    itemBlock = itemBlock.nextConnection && itemBlock.nextConnection.targetBlock();
                }
                this.itemCount_ = connections.length;
                this.updateShape_();
                for (let i = 0; i < this.itemCount_; i++) {
                    Blockly.Mutator.reconnect(connections[i], this, 'ADD' + i);
                }
            },
            updateShape_: function() {
                for (let i = this.itemCount_ - 1; i >= 0; i--) {
                    if (this.getInput('ADD' + i)) {
                        this.removeInput('ADD' + i);
                    }
                }
                for (let i = 0; i < this.itemCount_; i++) {
                    const input = this.appendValueInput('ADD' + i).setCheck("Number");
                    if (i > 0) {
                        input.appendField(this.operator_);
                    }
                }
            },
            setOperator: function(operator) {
                this.operator_ = operator;
                this.updateShape_();
            }
        };

        Blockly.Blocks['math_generic_container'] = {
            init: function() {
                this.setColour("#71b700");
                this.appendDummyInput().appendField("數字輸入");
                this.appendStatementInput('STACK');
                this.contextMenu = false;
            }
        };

        Blockly.Blocks['math_generic_item'] = {
            init: function() {
                this.setColour("#71b700");
                this.appendDummyInput().appendField("項目");
                this.setPreviousStatement(true);
                this.setNextStatement(true);
                this.contextMenu = false;
            }
        };

        function createOperatorBlock(type, operatorSymbol) {
            Blockly.Blocks[type] = Object.assign({}, Blockly.Blocks['math_generic'], {
                init: function() {
                    Blockly.Blocks['math_generic'].init.call(this);
                    this.setOperator(operatorSymbol);
                }
            });
        }

        createOperatorBlock('math_plus', '+');
        createOperatorBlock('math_multiply', '*');
        createOperatorBlock('math_percent', '%');
        createOperatorBlock('math_devide', '/');
        createOperatorBlock('math_subtract', '-');
        createOperatorBlock('commas', ',');
        createOperatorBlock('scanf_block', ' ');
        //A function of Cpp block convert to Cpp.
        //infinity
        Blockly.Cpp['math_plus'] = function(block) {
            return generateCode(block, ' + ');
        };
        Blockly.Cpp['math_multiply'] = function(block) {
            return generateCode(block, ' * ');
        };
        Blockly.Cpp['math_percent'] = function(block) {
            return generateCode(block, ' % ');
        };
        Blockly.Cpp['math_devide'] = function(block) {
            return generateCode(block, ' / ');
        };
        Blockly.Cpp['math_subtract'] = function(block) {
            return generateCode(block, ' - ');
        };
        Blockly.Cpp['commas'] = function(block) {
            return generateCode(block, ' , ');
        };
        Blockly.Cpp['scanf_block'] = function(block){
            return generateCode(block, ' ');
        }
        function generateCode(block, operator) {
            let code = '';
            for (let i = 0; i < block.itemCount_; i++) {
                let argument = Blockly.Cpp.valueToCode(block, 'ADD' + i, 1) || '0';
                if (argument.startsWith('(') && argument.endsWith(')')) {
                    argument = argument.slice(1, -1);
                }
                code += argument;
                if (i < block.itemCount_ - 1) {
                    code += operator;
                }
            }
            return [`(${code})`, 1];
        }

        //data
        Blockly.Cpp['add_line'] = function(block) {
            return [`\n`, 1];
        };

        Blockly.Cpp['tab'] = function(block) {
            return [`  `, 1];
        };
        
        Blockly.Cpp['text'] = function(block) {
            var text = block.getFieldValue('TEXT') || '';
            return [`"${text}"`, 1];
        };

        Blockly.Cpp['comment_block'] = function(block) {
            return `// ${block.getFieldValue('COMMENT')}\n`;
        };

        Blockly.Cpp['number'] = function(block) {
            return [block.getFieldValue('NUMBER') || '0', 1];
        };

        //initializaiton
        Blockly.Cpp['boost_ios_sync'] = function(block) {
            return 'std::ios::sync_with_stdio(0);\n';
        };

        Blockly.Cpp['boost_cin_cout_tie'] = function(block) {
            return 'std::cin.tie(0); std::cout.tie(0);\n';
        };

        Blockly.Cpp['include_bits/stdc++.h'] = function(block) {
            return '#include <bits/stdc++.h>\n';
        };

        Blockly.Cpp['using_namespace_std'] = function(block) {
            return 'using namespace std;\n\n';
        };

        Blockly.Cpp['main_block'] = function(block) {
            var statements_body = Blockly.Cpp.statementToCode(block, 'DO');
            return `int main() {\n${statements_body}\n  return 0;\n}`;
        };

        //stop
        Blockly.Cpp['break_block'] = function() {
            return 'break;\n';
        };

        Blockly.Cpp['continue_block'] = function() {
            return 'continue;\n';
        };

        Blockly.Cpp['return_block'] = function(block) {
            var returnValue = Blockly.Cpp.valueToCode(block, 'RETURN_VALUE', 1) || '0';
            return `return ${returnValue};\n`;
        };

        Blockly.Cpp['return_no_out'] = function(block) {
            var code = 'return'
            return [code, 1];
        };

        //condition
        Blockly.Cpp['switch_block'] = function(block) {
            var switchValue = Blockly.Cpp.valueToCode(block, 'SWITCH_VALUE', 1) || '()';
            var caseStatements = Blockly.Cpp.statementToCode(block, 'DO');
            return `switch ${switchValue} {\n${caseStatements}}\n`;
        };

        Blockly.Cpp['case_block'] = function(block) {
            var caseValue = Blockly.Cpp.valueToCode(block, 'CASE_VALUE', 1) || '0';
            var statements_do = Blockly.Cpp.statementToCode(block, 'DO');

            if (caseValue.startsWith('(') && caseValue.endsWith(')')) {
                caseValue = caseValue.slice(1, -1);
            }

            return `case ${caseValue}:\n${statements_do}\nbreak;\n`;
        };

        Blockly.Cpp['default_block'] = function(block) {
            var statements_do = Blockly.Cpp.statementToCode(block, 'DO');
            return `default:\n${statements_do}\nbreak;\n`;
        };

        Blockly.Cpp['while_block'] = function(block) {
            var condition = Blockly.Cpp.valueToCode(block, 'CONDITION', 1) || `((false))`;
            var statements_do = Blockly.Cpp.statementToCode(block, 'DO');

            if (condition.startsWith('(') && condition.endsWith(')')) {
                condition = condition.slice(1, -1);
            }

            var code = 'while ' + condition + ' {\n' + statements_do + '\n}\n';
            return code;
        };

        Blockly.Cpp['controls_if'] = function(block) {
            var n = 0;
            var code = '';

            // 首先生成 if 條件
            if (block.getInput('IF' + n)) {
                var conditionCode = Blockly.Cpp.valueToCode(block, 'IF' + n, 1) || 'false';
                var branchCode = Blockly.Cpp.statementToCode(block, 'DO' + n); // 使用 "DO" + n，與定義一致
                if (conditionCode.startsWith('(') && conditionCode.endsWith(')')) {
                    conditionCode = conditionCode.slice(1, -1);
                }
                code += 'if (' + conditionCode + ') {\n' + branchCode + '}\n';
                n++;
            }

            // 生成 else if 條件
            while (block.getInput('IF' + n)) {
                var elseIfConditionCode = Blockly.Cpp.valueToCode(block, 'IF' + n, 1) || 'false';
                var elseIfBranchCode = Blockly.Cpp.statementToCode(block, 'DO' + n);
                if (conditionCode.startsWith('(') && conditionCode.endsWith(')')) {
                    conditionCode = conditionCode.slice(1, -1);
                }
                code += 'else if (' + elseIfConditionCode + ') {\n' + elseIfBranchCode + '}\n';
                n++;
            }

            // 最後生成 else 分支
            if (block.getInput('ELSE')) {
                var elseBranch = Blockly.Cpp.statementToCode(block, 'ELSE');
                code += 'else {\n' + elseBranch + '}\n';
            }

            return code;
        };

        Blockly.Cpp['for_block'] = function(block) {
            var varName = block.getFieldValue('VAR');
            var varName2 = block.getFieldValue('VAR2');
            var init = Blockly.Cpp.valueToCode(block, 'INIT', 1);
            var condition = Blockly.Cpp.valueToCode(block, 'CONDITION', 1) || 'false';
            var condition2 = Blockly.Cpp.valueToCode(block, 'CONDITION2', 1) || `${varName} + 1`;
            var statements_body = Blockly.Cpp.statementToCode(block, 'DO')

            if (condition.startsWith('(') && condition.endsWith(')')) {
                condition = condition.slice(1, -1);
            }
            if (condition2.startsWith('(') && condition2.endsWith(')')) {
                condition2 = condition2.slice(1, -1);
            }
            if (varName.startsWith('(') && varName.endsWith(')')) {
                varName = varName.slice(1, -1);
            }
            if (varName2.startsWith('(') && varName2.endsWith(')')) {
                varName2 = varName2.slice(1, -1);
            }

            return `for (int ${varName} = ${init}; ${condition}; ${varName2} = ${condition2}) {\n${statements_body}}\n`;
        };

        //input and output
        Blockly.Cpp['cin_block'] = function(block) {
            var value_var = Blockly.Cpp.valueToCode(block, 'VARIABLES', 1);
            if (value_var.startsWith('(') && value_var.endsWith(')')) {
                value_var = value_var.slice(1, -1);
            }

            return `std::cin >> ${value_var};\n`;
        };

        Blockly.Cpp['cout_block'] = function(block) {
            var argument = Blockly.Cpp.valueToCode(block, 'INPUT', 1) || '';

            if (argument.startsWith('(') && argument.endsWith(')')) {
                argument = argument.slice(1, -1);
            }

            if (argument.endsWith(';\n')) {
                argument = argument.slice(0, -2);
            }

            if (isNaN(argument) && !argument.startsWith('"') && !argument.endsWith('"')) {
                argument = `${argument}`;
            }

            if (block.getFieldValue('ENDL_OPTION') === "endl") {
                return `std::cout << ${argument} << std::endl;\n`;
            } else {
                return `std::cout << ${argument};\n`;
            }
        };

        //operation
        Blockly.Cpp['logic_not'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'A', 1) || 'true';

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return `!${Value};\n`;
        };

        Blockly.Cpp['logic_operators'] = function(block) {
            var Value1 = Blockly.Cpp.valueToCode(block, 'A', 1) || '0';
            var Value2 = Blockly.Cpp.valueToCode(block, 'B', 1) || '0';

            var operator = block.getFieldValue('OPERATOR');
            var operatorSymbol;

            switch (operator) {
                case 'EQUAL':
                    operatorSymbol = '==';
                    break;
                case 'NOT_EQUAL':
                    operatorSymbol = '!=';
                    break;
                case 'GREATER':
                    operatorSymbol = '>';
                    break;
                case 'LESS':
                    operatorSymbol = '<';
                    break;
                case 'GREATER_EQUAL':
                    operatorSymbol = '>=';
                    break;
                case 'LESS_EQUAL':
                    operatorSymbol = '<=';
                    break;
                default:
                    operatorSymbol = '==';
            }

            if (Value1.startsWith('(') && Value1.endsWith(')')) {
                Value1 = Value1.slice(1, -1);
            }
            if (Value2.startsWith('(') && Value2.endsWith(')')) {
                Value2 = Value2.slice(1, -1);
            }

            code = `(${Value1} ${operatorSymbol} ${Value2})`;
            return [code, 1];
        };

        Blockly.Cpp['or_and_xor'] = function(block) {
            var Value1 = Blockly.Cpp.valueToCode(block, 'A', 1) || '0';
            var Value2 = Blockly.Cpp.valueToCode(block, 'B', 1) || '0';

            var operator = block.getFieldValue('OPERATOR');
            var operatorSymbol;

            switch (operator) {
                case 'AND':
                    operatorSymbol = '&&';
                    break;
                case 'OR':
                    operatorSymbol = '||';
                    break;
                case 'XOR':
                    operatorSymbol = '^';
                    break;
                case 'NOT':
                    operatorSymbol = '!';
                    break;
                default:
                    operatorSymbol = '&&';
            }

            if (Value1.startsWith('(') && Value1.endsWith(')')) {
                Value1 = Value1.slice(1, -1);
            }
            if (Value2.startsWith('(') && Value2.endsWith(')')) {
                Value2 = Value2.slice(1, -1);
            }

            code = `(${Value1} ${operatorSymbol} ${Value2})`;
            return [code, 1];
        };

        Blockly.Cpp['var_caculacte'] = function(block) {
            var Value1 = Blockly.Cpp.valueToCode(block, 'A', 1) || '0';
            var Value2 = Blockly.Cpp.valueToCode(block, 'B', 1) || '0';

            var operator = block.getFieldValue('OPERATOR');
            var operatorSymbol;

            switch (operator) {
                case 'ADD_EQUALS':
                    operatorSymbol = '+=';
                    break;
                case 'SUBTRACT_EQUALS':
                    operatorSymbol = '-=';
                    break;
                case 'MUTIPLY_EQUALS':
                    operatorSymbol = '*=';
                    break;
                case 'DEVIDE_EQUALS':
                    operatorSymbol = '/=';
                    break;
                case 'MODULO_EQUALS':
                    operatorSymbol = '%=';
                    break;
                default:
                    operatorSymbol = '+=';
            }

            if (Value1.startsWith('(') && Value1.endsWith(')')) {
                Value1 = Value1.slice(1, -1);
            }
            if (Value2.startsWith('(') && Value2.endsWith(')')) {
                Value2 = Value2.slice(1, -1);
            }

            code = `(${Value1} ${operatorSymbol} ${Value2})`;

            return [code, 1];
        };

        //bool
        Blockly.Cpp['true'] = function() {
            return ['true', 1];
        };

        Blockly.Cpp['false'] = function() {
            return ['false', 1];
        };

        Blockly.Cpp['null'] = function() {
            return ['nullptr', 1];
        };

        //define variable
        Blockly.Cpp['declare_variable'] = function(block) {
            var Const = block.getFieldValue('const');
            var unsigned = block.getFieldValue('unsigned');
            var type = block.getFieldValue('TYPE');
            var var_name = block.getFieldValue('var_name');
            var value = Blockly.Cpp.valueToCode(block, 'value', 1) || '';
            code = '';
            if (Const === 'const'){
                code += 'const ';
            }
            if (unsigned === 'unsigned'){
                code += 'unsigned ';
            }
            
            code += type + ' ' + var_name;
            if (value.startsWith('(') && value.endsWith(')')){
                value = value.slice(1, -1);
            }
            code += ` = ${value};\n`;
            return code;
        };

        Blockly.Cpp['variable_assignment'] = function(block) {
            var variable = block.getFieldValue('VAR_NAME');
            var value = Blockly.Cpp.valueToCode(block, 'VALUE', 1) || '0';
            if (value.startsWith('(') && value.endsWith(')')) {
                value = value.slice(1, -1);
            }
            return `${variable} = ${value};\n`;
        };

        Blockly.Cpp['get_variable'] = function(block) {
            var variable = block.getFieldValue('VAR_NAME');
            return [`${variable}`, 1];
        };

        //function
        Blockly.Cpp['function_call'] = function(block) {
            var funcName = block.getFieldValue('funcName');
            var value = Blockly.Cpp.valueToCode(block, 'VALUE', 1);
            if (value.startsWith('(') && value.endsWith(')')){
                value = value.slice(1, -1);
            }
            if (value){
                return `${funcName}(${value});\n`;
            }
            else{
                return funcName + '\n';
            }
            
        };

        Blockly.Cpp['function_definition'] = function(block) {
            var Type = block.getFieldValue('TYPE');
            var funcName = block.getFieldValue('funcName');
            var data = Blockly.Cpp.valueToCode(block, 'data', 1);
            var content = Blockly.Cpp.statementToCode(block, 'DO') || '';
            var expression = Blockly.Cpp.valueToCode(block, 'expression', 1);
            if (data.startsWith('(') && data.endsWith(')')) {
                    data = data.slice(1, -1);
            }
            if (content.startsWith('(') && content.endsWith(')')) {
                content = content.slice(1, -1);
            }
            if (expression.startsWith('(') && expression.endsWith(')')) {
                expression = expression.slice(1, -1);
            }

            return `${Type} ${funcName}(${data}){\n${content}  return${expression}\n}\n`;
        };
        
        Blockly.Cpp['function_definition_void'] = function(block) {
            var funcName = block.getFieldValue('funcName');
            var data = Blockly.Cpp.valueToCode(block, 'data', 1);
            var content = Blockly.Cpp.statementToCode(block, 'DO') || '';
            var expression = block.getFieldValue('expression');
            if (data.startsWith('(') && data.endsWith(')')) {
                    data = data.slice(1, -1);
            }
            if (content.startsWith('(') && content.endsWith(')')) {
                content = content.slice(1, -1);
            }

            if (expression === 'no'){
                return `void ${funcName}(${data}){\n${content}\n}\n`;
            }
            else{
                return `void ${funcName}(${data}){\n${content}  return\n}\n`;
            }
        };


        //unwork 
        Blockly.Cpp['boost_printf'] = function(block) {
            var format = Blockly.Cpp.valueToCode(block, 'FORMAT', 1);
            return 'printf("%s", ' + format + ');\n';
        };

        //math
        Blockly.Cpp['math_random'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'RANGE', 1);

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return [`rand() % ${Value};\n`, Blockly.Cpp.ORDER_ATOMIC];
        };

        Blockly.Cpp['math_floor'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'X', 1);

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return [`floor(${Value});\n`, Blockly.Cpp.ORDER_ATOMIC];
        };

        Blockly.Cpp['math_ceil'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'X', 1);

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return [`ceil(${Value});\n`, , Blockly.Cpp.ORDER_ATOMIC];
        };

        Blockly.Cpp['math_tangent'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'ANGLE', 1);

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return [`tan(${Value});\n`, Blockly.Cpp.ORDER_ATOMIC];
        };

        Blockly.Cpp['math_cosine'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'ANGLE', 1);

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return [`cos(${Value});\n`, Blockly.Cpp.ORDER_ATOMIC];
        };

        Blockly.Cpp['math_sine'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'ANGLE', 1);

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return [`sin(${Value});\n`, Blockly.Cpp.ORDER_ATOMIC];
        };

        Blockly.Cpp['math_abs'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'A', 1);

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return [`abs(${Value});\n`, Blockly.Cpp.ORDER_ATOMIC];
        };

        Blockly.Cpp['math_sqrt'] = function(block) {
            var Value = Blockly.Cpp.valueToCode(block, 'X', 1);

            if (Value.startsWith('(') && Value.endsWith(')')) {
                Value = Value.slice(1, -1);
            }

            return [`sqrt(${Value});\n`, Blockly.Cpp.ORDER_ATOMIC];
        };

        Blockly.Cpp['math_caculacte'] = function(block) {
            var Value1 = Blockly.Cpp.valueToCode(block, 'A', 1) || '0';
            var Value2 = Blockly.Cpp.valueToCode(block, 'B', 1) || '0';

            var operator = block.getFieldValue('OPERATOR');
            var operatorSymbol;

            switch (operator) {
                case 'ADD':
                    operatorSymbol = '+';
                    break;
                case 'SUBTRACT':
                    operatorSymbol = '-';
                    break;
                case 'MUTIPLY':
                    operatorSymbol = '*';
                    break;
                case 'DEVIDE':
                    operatorSymbol = '/';
                    break;
                case 'DEVIDE_INT':
                    operatorSymbol = '//';
                    break;
                case 'MODULO':
                    operatorSymbol = '%';
                    break;
                case 'POWER':
                    operatorSymbol = '^';
                    break;
                default:
                    operatorSymbol = '+';
            }

            if (Value1.startsWith('(') && Value1.endsWith(')')) {
                Value1 = Value1.slice(1, -1);
            }
            if (Value2.startsWith('(') && Value2.endsWith(')')) {
                Value2 = Value2.slice(1, -1);
            }

            let code;
            if (operator === 'POWER') {
                code = `pow(${Value1}, ${Value2})`;
            } else {
                code = `(${Value1} ${operatorSymbol} ${Value2})`;
            }

            return [code, 1];
        };

        //vector
        Blockly.Cpp['push_back'] = function(block) {
            var vec_name = block.getFieldValue('vec_name');
            var number = Blockly.Cpp.valueToCode(block, 'number', 1) || '';
            if (number.startsWith('(') && number.endsWith(')')) {
                number = number.slice(1, -1);
            }
            return vec_name + ".push_back(" + number + ");\n";
        };

        Blockly.Cpp['pop_back'] = function(block) {
            var vec_name = block.getFieldValue('vec_name');
            return vec_name + ".pop_back();\n";
        };

        Blockly.Cpp['emplace_back'] = function(block) {
            var name = block.getFieldValue('NAME');
            var num = block.getFieldValue('number');
            return code = name + ".emplace_back(" + num + ");\n";
        };

        Blockly.Cpp['define_vector'] = function(block) {
            var type = block.getFieldValue('TYPE');
            var vec_name = block.getFieldValue('vec_name');
            var vec_size = Blockly.Cpp.valueToCode(block, 'vec_size', 1) || '';
            var content = Blockly.Cpp.valueToCode(block, 'vec_content', 1) || '';
            var code = `vector<${type}>${vec_name}`;
            if (vec_size) {
                if (vec_size.startsWith('(') && vec_size.endsWith(')')) {
                    vec_size = vec_size.slice(1, -1);
                }
                code += '(' + vec_size;
            }
            if (content) {
                if (content.startsWith('(') && content.endsWith(')')) {
                    content = content.slice(1, -1);
                }
                if (vec_size) {
                    code += ' , ' + content;
                } else {
                    code += '(' + content;
                }
            }
            if (vec_size || content) {
                code += ')';
            }
            return code;
        }

        Blockly.Cpp['vec_begin'] = function(block) {
            var vec_name = block.getFieldValue('vec_name') || '';
            var code = vec_name + '.begin()';
            return [code, 1];
        }

        Blockly.Cpp['vec_end'] = function(block) {
            var vec_name = block.getFieldValue('vec_name') || '';
            var code = vec_name + 'end()';
            return [code, 1];
        }

        Blockly.Cpp['vec_rbegin'] = function(block) {
            var vec_name = block.getFieldValue('vec_name') || '';
            var code = vec_name + '.rbegin()';
            return [code, 1];
        }

        Blockly.Cpp['vec_rend'] = function(block) {
            var vec_name = block.getFieldValue('vec_name') || '';
            var code = vec_name + '.rend()';
            return [code, 1];
        }

        Blockly.Cpp['vector_insert'] = function(block) {
            var vec_name = block.getFieldValue('vec_name');
            var pos = Blockly.Cpp.valueToCode(block, 'pos', 1);
            var value = Blockly.Cpp.valueToCode(block, 'value', 1);
            if (pos === '0'){
                pos = '';
            }
            else{
                if (pos.startsWith('(') && pos.endsWith(')')){
                    pos = pos.slice(1, -1);
                }
            }
            if (value.startsWith('(') && value.endsWith(')')){
                    value = value.slice(1, -1);
            }
            
            return `${vec_name}.insert(${vec_name}.begin()+${pos}, ${value})`; 
        }

        Blockly.Cpp['vector_erase'] = function(block) {
            var vec_name = block.getFieldValue('vec_name');
            var pos = Blockly.Cpp.valueToCode(block, 'pos', 1);
            var value = Blockly.Cpp.valueToCode(block, 'value', 1);
            if (pos === '0'){
                pos = '';
            }
            else{
                if (pos.startsWith('(') && pos.endsWith(')')){
                    pos = pos.slice(1, -1);
                }
            }
            if (value.startsWith('(') && value.endsWith(')')){
                    value = value.slice(1, -1);
            }
            
            return `${vec_name}.insert(${vec_name}.begin()+${pos}, ${value})`; 
        }

        Blockly.Cpp['vector_clear'] = function(block) {
            var vec_name = block.getFieldValue('vec_name');
            return vec_name + ".clear();\n";
        };

        Blockly.Cpp['vector_size'] = function(block) {
            var vec_name = block.getFieldValue('vec_name');
            return vec_name + ".size();\n";
        }

        Blockly.Cpp['vector_empty'] = function(block) {
            var vec_name = block.getFieldValue('vec_name');
            var code = vec_name + ".empty";
            return [code, 1];
        }
        
        //array
        Blockly.Cpp['create_array'] = function(block) {
            var type = block.getFieldValue('TYPE');
            var array_name = block.getFieldValue('array_name');
            var size = Blockly.Cpp.valueToCode(block, 'size', 1) || '';
            var content = Blockly.Cpp.valueToCode(block, 'content', 1) || '';
            if (size.startsWith('(') && size.endsWith(')')) {
                size = size.slice(1, -1);
            }
            if (content === '') {
                return `${type} ${array_name}[${size}];`
            }
            if (content.startsWith('(') && content.endsWith(')')) {
                content = content.slice(1, -1);
            }
            return `${type} ${array_name}[${size}] = ${content};`
        }

        Blockly.Cpp['array_name_block'] = function(block) {
            var array_name = block.getFieldValue('array_name');
            return [array_name, 1];
        }

        Blockly.Cpp['array_content'] = function(block) {
            var content = Blockly.Cpp.valueToCode(block, 'content', 1);
            if (content.startsWith('(') && content.endsWith(')')) {
                content = content.slice(1, -1);
            }
            return [`{${content}}`, 1];
        }

        Blockly.Cpp['array[i]'] = function(block) {
            var array_name = block.getFieldValue('array_name');
            var pos = Blockly.Cpp.valueToCode(block, 'pos', 1);
            if (pos.startsWith('(') && pos.endsWith(')')){
                pos = pos.slice(1, -1);
            }
            var code = `${array_name}[${pos}]`;
            return [code, 1];
        }

        //map
        Blockly.Cpp['create_map'] = function(block) {
            var type1 = block.getFieldValue('TYPE1');
            var type2 = block.getFieldValue('TYPE2');
            var map_name = block.getFieldValue('map_name');
            var map_size = Blockly.Cpp.valueToCode(block, 'map_size', 1);
            var content = Blockly.Cpp.valueToCode(block, 'content', 1);
            var code = `map<${type1}, ${type2}>${map_name}`;
            if (map_size){
                if (map_size.startsWith('(') && map_size.endsWith(')')){
                    map_size = map_size.slice(1, -1);
                }
                code += '(' + map_size;
            } 
            if (content){
                if (content.startsWith('(') && content.endsWith(')')){
                    content = content.slice(1, -1);
                }
                if (map_size){
                    code += ' , ' + content;
                }
                else{
                    code += '(' + content;
                }
            }
            if (map_size || content){
                code += ')';
            }
            return code;
        }

        Blockly.Cpp['map_insert'] = function(block) {
            var map_name = block.getFieldValue('map_name');
            var first = Blockly.Cpp.valueToCode(block, 'first', 1) || '';
            var second = Blockly.Cpp.valueToCode(block, 'second', 1) || '';
            if (first.startsWith('(') && first.endsWith(')')){
                first = first.slice(1, -1);
            }
            if (second.startsWith('(') && second.endsWith(')')){
                second = second.slice(1, -1);
            }
            return `${map_name}.insert({${first}, ${second}})`;
        }

        Blockly.Cpp['map[i]'] = function(block) {
            var map_name = block.getFieldValue('map_name');
            var map_key = block.getFieldValue('map_key');
            var map_value = block.getFieldValue('map_value');
            return `${map_name}[${map_key}] = ${map_value}`;
        }        

        Blockly.Cpp['map_begin'] = function(block) {
            var map_name = block.getFieldValue('map_name') || '';
            var code = map_name + '.begin()';
            return [code, 1];
        }

        Blockly.Cpp['map_end'] = function(block) {
            var map_name = block.getFieldValue('map_name') || '';
            var code = map_name + 'end()';
            return [code, 1];
        }

        Blockly.Cpp['map_rbegin'] = function(block) {
            var map_name = block.getFieldValue('map_name') || '';
            var code = map_name + '.rbegin()';
            return [code, 1];
        }

        Blockly.Cpp['map_rend'] = function(block) {
            var map_name = block.getFieldValue('map_name') || '';
            var code = map_name + '.rend()';
            return [code, 1];
        }

        Blockly.Cpp['map_clear'] = function(block) {
            var map_name = block.getFieldValue('map_name');
            return map_name + ".clear();\n";
        };

        Blockly.Cpp['map_size'] = function(block) {
            var map_name = block.getFieldValue('map_name');
            return map_name + ".size();\n";
        }

        Blockly.Cpp['map_empty'] = function(block) {
            var map_name = block.getFieldValue('map_name');
            var code = map_name + ".empty";
            return [code, 1];
        }

        Blockly.Cpp['map_first'] = function(block) {
            var map_name = block.getFieldValue('map_name');
            var key = Blockly.Cpp.valueToCode(block, 'key', 1);
            if (key.startsWith('(') && key.endsWith(')')){
                key = key.slice(1, -1);
            }
            var code = `${map_name}[${key}].first`;
            return [code, 1];
        }
        
        Blockly.Cpp['map_second'] = function(block) {
            var map_name = block.getFieldValue('map_name');
            var key = Blockly.Cpp.valueToCode(block, 'key', 1);
            if (key.startsWith('(') && key.endsWith(')')){
                key = key.slice(1, -1);
            }
            var code = `${map_name}[${key}].second`;
            return [code, 1];
        }

        Blockly.Cpp['map_find'] = function(block) {
            var map_name = block.getFieldValue('map_name');
            var value = Blockly.Cpp.valueToCode(block, 'value', 1);
            if (value.startsWith('(') && value.endsWith(')')){
                value = value.slice(1, -1);
            }
            var code = `${map_name}.find(${value})`;
            return [code, 1];
        }


        //set
        Blockly.Cpp['create_set'] = function(block) {
            var type = block.getFieldValue('TYPE');
            var set_name = block.getFieldValue('set_name');
            var set_size = Blockly.Cpp.valueToCode(block, 'set_size', 1) || '';
            var content = Blockly.Cpp.valueToCode(block, 'set_content', 1) || '';
            var code = `set<${type}>${set_name}`;
            if (set_size){
                if (set_size.startsWith('(') && set_size.endsWith(')')){
                    set_size = set_size.slice(1, -1);
                }
                code += '(' + set_size;
            }
            if (content){
                if (content.startsWith('(') && content.endsWith(')')){
                    content = content.slice(1, -1);
                }
                if (set_size){
                    code += ' , ' + content;
                }
                else{
                    code += '(' + content;
                }
            }
            if (set_size || content){
                code += ')';
            }
            return code;
        }

        Blockly.Cpp['set_insert'] = function(block) {
            var set_name = block.getFieldValue('set_name') || '';
            var value = Blockly.Cpp.valueToCode(block, 'value', 1) || '';
            if (value.startsWith('(') && value.endsWith(')')){
                value = value.slice(1, -1);
            }
            return `${set_name}.insert(${value})`;
        }

        Blockly.Cpp['set_erase'] = function(block) {
            var set_name = block.getFieldValue('set_name') || '';
            var value = Blockly.Cpp.valueToCode(block, 'value', 1) || '';
            if (value.startsWith('(') && value.endsWith(')')){
                value = value.slice(1, -1);
            }
            return `${set_name}.insert(${value})`;
        }

        Blockly.Cpp['set_begin'] = function(block) {
            var set_name = block.getFieldValue('set_name') || '';
            var code = set_name + '.begin()';
            return [code, 1];
        }

        Blockly.Cpp['set_end'] = function(block) {
            var set_name = block.getFieldValue('set_name') || '';
            var code = set_name + 'end()';
            return [code, 1];
        }

        Blockly.Cpp['set_empty'] = function(block) {
            var set_name = block.getFieldValue('set_name');
            var code = set_name + ".empty";
            return [code, 1];
        }

        Blockly.Cpp['set_find'] = function(block) {
            var set_name = block.getFieldValue('set_name');
            var value = Blockly.Cpp.valueToCode(block, 'value', 1);
            if (value.startsWith('(') && value.endsWith(')')){
                value = value.slice(1, -1);
            }
            var code = `${set_name}.find(${value})`;
            return [code, 1];
        }

        //algorithm
        Blockly.Cpp['sort'] = function(block) {
            var type = block.getFieldValue('TYPE');
            var name = block.getFieldValue('name');
            var start = Blockly.Cpp.valueToCode(block, 'start', 1) || '';
            var end = Blockly.Cpp.valueToCode(block, 'end', 1) || '';
            if (start.startsWith('(') && start.endsWith(')')){
                start = start.slice(1, -1);
            }
            if (end.startsWith('(') && end.endsWith(')')){
                end = end.slice(1, -1);
            }
            
            if (start === '0'){
                start = '';
            }
            else{
                start = '+' + start;
            }
            
            if (type === "內建陣列"){
                return `sort(${name}${start}, ${name}+${end})\n`;
            }
            else{
                return `sort(${name}.begin()${start}, ${name}.begin()+${end})\n`;
            }
        }

        Blockly.Cpp['max'] = function(block) {
            var type = block.getFieldValue('TYPE');
            var name = block.getFieldValue('name');
            var start = Blockly.Cpp.valueToCode(block, 'start', 1) || '';
            var end = Blockly.Cpp.valueToCode(block, 'end', 1) || '';
            if (start.startsWith('(') && start.endsWith(')')){
                start = start.slice(1, -1);
            }
            if (end.startsWith('(') && end.endsWith(')')){
                end = end.slice(1, -1);
            }

            if (start === '0'){
                start = '';
            }
            else{
                start = '+' + start;
            }

            if (type === "內建陣列"){
                return `*max_element(${name}+${start}, ${name}+${end})\n`;
            }
            else{
                return `*max_element(${name}.begin()+${start}, ${name}.begin()+${end})\n`;
            }
        }

        Blockly.Cpp['min'] = function(block) {
            var type = block.getFieldValue('TYPE');
            var name = block.getFieldValue('name');
            var start = Blockly.Cpp.valueToCode(block, 'start', 1) || '';
            var end = Blockly.Cpp.valueToCode(block, 'end', 1) || '';
            if (start.startsWith('(') && start.endsWith(')')){
                start = start.slice(1, -1);
            }
            if (end.startsWith('(') && end.endsWith(')')){
                end = end.slice(1, -1);
            }
            
            if (start === '0'){
                start = '';
            }
            else{
                start = '+' + start;
            }

            if (type === "內建陣列"){
                return `*min_element(${name}+${start}, ${name}+${end})\n`;
            }
            else{
                return `*min_element(${name}.begin()+${start}, ${name}.begin()+${end})\n`;
            }
        }

        Blockly.Cpp['find'] = function(block) {
            var type = block.getFieldValue('TYPE');
            var name = block.getFieldValue('name');
            var value = Blockly.Cpp.valueToCode(block, 'value', 1) || '';
            var start = Blockly.Cpp.valueToCode(block, 'start', 1) || '';
            var end = Blockly.Cpp.valueToCode(block, 'end', 1) || '';
            if (start.startsWith('(') && start.endsWith(')')){
                start = start.slice(1, -1);
            }
            if (end.startsWith('(') && end.endsWith(')')){
                end = end.slice(1, -1);
            }
            if (value.startsWith('(') && value.endsWith(')')){
                value = value.slice(1, -1);
            }
            
            if (start === '0'){
                start = '';
            }
            else{
                start = '+' + start;
            }

            if (type === "內建陣列"){
                return `find(${name}${start}, ${name}+${end}, ${value})\n`;
            }
            else{
                return `find(${name}.begin()${start}, ${name}.begin()+${end}, ${value})\n`;
            }
        }

        //time
        Blockly.Cpp['get_current_timestamp'] = function(block) {
            return 'time_t currentTime = time(nullptr);\n';
        };

        Blockly.Cpp['calculate_time_difference'] = function(block) {
            var endTime = Blockly.Cpp.valueToCode(block, 'END_TIME', Blockly.Cpp.ORDER_ATOMIC) || '0';
            var startTime = Blockly.Cpp.valueToCode(block, 'START_TIME', Blockly.Cpp.ORDER_ATOMIC) || '0';
            return 'double diff = difftime(' + endTime + ', ' + startTime + ');\n';
        };

        Blockly.Cpp['convert_to_local_time'] = function(block) {
            var timestamp = Blockly.Cpp.valueToCode(block, 'TIMESTAMP', Blockly.Cpp.ORDER_ATOMIC) || '0';
            return 'tm* localTime = localtime(&' + timestamp + ');\n';
        };

        Blockly.Cpp['convert_to_utc_time'] = function(block) {
            var timestamp = Blockly.Cpp.valueToCode(block, 'TIMESTAMP', Blockly.Cpp.ORDER_ATOMIC) || '0';
            return 'tm* utcTime = gmtime(&' + timestamp + ');\n';
        };

        Blockly.Cpp['format_time_string'] = function(block) {
            var timeStruct = Blockly.Cpp.valueToCode(block, 'TIME_STRUCT', Blockly.Cpp.ORDER_ATOMIC) || 'tm';
            var format = block.getFieldValue('FORMAT') || '%Y-%m-%d %H:%M:%S';
            return 'char buffer[80];\nstrftime(buffer, sizeof(buffer), "' + format + '", &' + timeStruct + ');\n';
        };

        Blockly.Cpp['set_time_structure'] = function(block) {
            var year = Blockly.Cpp.valueToCode(block, 'YEAR', Blockly.Cpp.ORDER_ATOMIC) || '0';
            var month = Blockly.Cpp.valueToCode(block, 'MONTH', Blockly.Cpp.ORDER_ATOMIC) || '0';
            var day = Blockly.Cpp.valueToCode(block, 'DAY', Blockly.Cpp.ORDER_ATOMIC) || '0';
            var hour = Blockly.Cpp.valueToCode(block, 'HOUR', Blockly.Cpp.ORDER_ATOMIC) || '0';
            var minute = Blockly.Cpp.valueToCode(block, 'MINUTE', Blockly.Cpp.ORDER_ATOMIC) || '0';
            var second = Blockly.Cpp.valueToCode(block, 'SECOND', Blockly.Cpp.ORDER_ATOMIC) || '0';
            return 'tm timeStruct = {};\n' +
                'timeStruct.tm_year = ' + year + ' - 1900;\n' +
                'timeStruct.tm_mon = ' + month + ' - 1;\n' +
                'timeStruct.tm_mday = ' + day + ';\n' +
                'timeStruct.tm_hour = ' + hour + ';\n' +
                'timeStruct.tm_min = ' + minute + ';\n' +
                'timeStruct.tm_sec = ' + second + ';\n';
        };

        Blockly.Cpp['read_time_structure_member'] = function(block) {
            var timeStruct = Blockly.Cpp.valueToCode(block, 'TIME_STRUCT', Blockly.Cpp.ORDER_ATOMIC) || 'tm';
            var member = block.getFieldValue('MEMBER') || 'tm_year';
            return timeStruct + '.' + member;
        };

        Blockly.Cpp['get_current_local_time'] = function(block) {
            return 'time_t currentTime = time(nullptr);\ntm* localTime = localtime(&currentTime);\n';
        };

        Blockly.Cpp['get_current_utc_time'] = function(block) {
            return 'time_t currentTime = time(nullptr);\ntm* utcTime = gmtime(&currentTime);\n';
        };

    </script>


</body>
</html>
